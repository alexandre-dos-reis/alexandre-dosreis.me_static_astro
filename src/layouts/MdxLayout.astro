---
import type { MDXLayoutProps } from "astro";
import type { Article } from "src/utils/types";
import HeadingsToc from "src/components/HeadingsToc.astro";
import HtmlLayout from "./HtmlLayout.astro";

type Props = MDXLayoutProps<Article>;

const { frontmatter: fm, headings } = Astro.props;

const headerSrcImage = (
  await Astro.glob<{ default: string }>(`/src/pages/**/head.{png,jpg,jpeg}`)
).find((x) => x.default.startsWith(`/src/pages${fm.url!}`))?.default;
---

<HtmlLayout title={fm.title}>
  <section
    class="relative flex justify-center items-center h-[21rem] md:h-[30rem] mb-4"
  >
    <div class="p-4 z-40">
      <div class="w-full text-center text-xl mb-4">Publi√© le {fm.date}</div>
      <h1 class="w-full text-center px-4">{fm.title}</h1>
    </div>
    <img
      src={headerSrcImage}
      class="absolute top-0 h-full w-full object-cover opacity-40"
    />
  </section>
  <main class="grid grid-cols-[2fr_1fr] items-start mx-auto max-w-4xl gap-x-10">
    <article class="max-w-xl markdown">
      <slot />
    </article>
    <aside class="block sticky top-24 text-xs overflow-y-scroll mt-20">
      <HeadingsToc headings={headings} />
    </aside>
  </main>
</HtmlLayout>
